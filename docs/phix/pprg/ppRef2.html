<html><head><title>Print Preview and Report Generator Reference Section</title></head>
<style type="text/css">
<!--
body        {background-color: "#D0D0D0";}
a           {text-decoration: none;}
a:link      {color: "#0033BB"; text-decoration: underline;}
a:visited   {color: "#006699"; text-decoration: underline;}
a:active    {color: red; text-decoration: underline;}
a:hover     {color: red; text-decoration: underline;}
a.blue    {text-decoration: none;}
a.blue:link      {color: "#5500FF"; text-decoration: underline;}
a.blue:visited   {color: "#5500FF"; text-decoration: underline;}
a.blue:active    {color: red; text-decoration: underline;}
a.blue:hover     {color: red; text-decoration: underline;}
a.brown      {text-decoration: none;}
a.brown:link      {color: "#993333"; text-decoration: underline;}
a.brown:visited   {color: "#993333"; text-decoration: underline;}
a.brown:active    {color: red; text-decoration: underline;}
a.brown:hover     {color: red; text-decoration: underline;}
OL.n        { list-style-type: arabic-numbers }
OL.ua       { list-style-type: upper-alpha }
-->
</style>
<style>
BODY {SCROLLBAR-FACE-COLOR: #330066; SCROLLBAR-HIGHLIGHT-COLOR: #CCCCFF; 
      SCROLLBAR-SHADOW-COLOR: #CCCCFF; SCROLLBAR-3DLIGHT-COLOR: #CCCCFF; 
      SCROLLBAR-ARROW-COLOR:    #FFFFFF; SCROLLBAR-TRACK-COLOR: #CCCCFF; 
      SCROLLBAR-DARKSHADOW-COLOR: #330066; }
</style>
<body>
<a href="pprg.html">Table of Contents</a>
<a href="ppRef.html">Previous Page - Reference Section Part 1</a>
<a href="ppRef3.html">Next Page - Reference Section Part 3</a>
<p><hr></p>
<p align=center>
<h2>Print Preview and Report Generator</h2>
<h3>Reference Section Part 2</h3></p>
<p><hr><p>
<p>
<a name=Layout></a>
<h3>Defining the Report Layout</h3>
<!-------------------------------->
<p>
        The same controls and key handling are used during report layout design as the
        report viewer.
<p>
        Double click on an existing field to edit it or select Insert from the right
        click popup to insert a new field.
<p>
<a name=jeditrect></a>
<a href="ppRef.html#jtwoup">Previous ScreenShot</a>
<a href="ppRef2.html#jeditbmp">Next ScreenShot</a><p>
<img src="images/editrect.jpg"
     alt="The Field Details (Graphic) Window.">
<br>
The Field Details (Graphic) Window.
<p>
When insert is selected, the field type can be changed between Graphic, Bitmap, or Text.
Changing the selection alters the Detail window contents.
When editing a field, as shown above, the type selection radio buttons are disabled.
<p>
<h5>Position</h5>
The position field is displayed for reference only. The units of measure can be altered,
or disabled, see the <a href=#Zoom>Zoom Window</a>.
<p>
<h5>Pen</h5>
Specify the pen width in pixels.
<p>
<h5>Style</h5>
Select a line style from Solid, Dash, Dot, DashDot, or DashDotDot.
<p>
<h5>Colour</h5>
Select one of the standard windows colours from the drop-down, enter an rgb value, or 
press F1 or click on the button to the right of the field to open the standard windows 
colour selection dialog. In edit mode the display is updated as the fields are altered 
(not insert mode).
<p>
<h5>Repeat</h5>
<small>[not properly functional in v0.2 on graphic or bitmap]</small><br>
<p>
<h5>Type</h5>
Select from Rectangle, RoundRectangle, Line, or Ellipse. Arcs and Chords may be drawn via
the pageSequenceHook() routine, but are not currently supported via this window.
<p>
<h5>Corner</h5>
This field only appears when a RoundRectangle is selected. If you experiment with the 
values, the display is updated (edit mode only). Refer to the documentation
for drawRoundRect() in win32lib for further details.
<p>
OK and Cancel should be self-explanatory. The Default button saves the settings
for use as a default when further new fields are entered during the current session.
<p>
<p>
<a name=jeditbmp></a>
<a href="#jeditrect">Previous ScreenShot</a>
<a href="#jedittext">Next ScreenShot</a><p>
<img src="images/editbmp.jpg"
     alt="The Field Details (Bitmap) Window.">
<br>
The Field Details (Bitmap) Window.
<p>
<h5>Paintmode</h5>
Select from SrcCopy, SrcPaint, SrcAnd, SrcInvert, SrcErase, NotSrcCopy, NotSrcErase,
MergeCopy, MergePaint, PatCopy, PatPaint, PatInvert ,DstInvert ,Blackness, or Whiteness.
See the Microsoft documentation for further details. Note that this field is disabled 
and automatically set to SrcPaint when Greyscale is in use, as shown.
<p>
<h5>File and path</h5>
Enter a path and filename or press F1 or click on the button to the right of this field 
to open a standard file browse window. Note that only .bmp files are supported.
<p>
<h5>Greyscale</h5>
Drag the slider bar to greyscale the graphic. When Greyscale is in use, the paintmode is 
automatically set to SrcPaint and disabled.
<p>
<h5>Repeat</h5>
<small>[not functional in v0.1 on graphic or bitmap]</small><br>
<p>
<p>
<a name=jedittext></a>
<a href="ppRef2.html#jeditbmp">Previous ScreenShot</a>
<a href="ppRef2.html#jdictLookup">Next ScreenShot</a><p>
<img src="images/edittext.jpg"
     alt="The Field Details (Text) Window.">
<br>
The Field Details (Text) Window.
<p>
<h5>Attributes</h5>
Bold, Italic, Underline, Strikeout, Colour, Font, and Size should be self-explanatory.
The small button next to the Colour field opens the standard windows colour dialogue to permit
non-standard colour selection (or a standard rgb value can be manually entered, eg #0dff60).
Updates to these fields are instantly reflected on the main window during edit mode.
<p>
<h5>TT and Fix</h5>
TT (True Type) and Fix (Fixed Width Fonts) restrict the font drop-down selection.<br>
Non-True type fonts cannot be scaled to match the printed report.<br>
Fixed width fonts may be required to align columns (if it is a composite field).
<br><small>[Note: for some reason Windows indicates Arial Alternative and Arial Alternative
    Symbol as fixed width fonts on this system (and Notepad displays those fonts as fixed
    width). I know not why.]</small>
<p>
<a name=Repeat></a>
<h5>Repeat</h5>
The Repeat field controls how many times the field should appear:
<p>
<table border cellpadding=10 cellspacing=0>
<tr><th>&lt;blank&gt;<td>The field appears in this position, on every page.
<tr><th>1<td>Each occurence of the field in the datastream appears precisely once on the report.
<tr><th>n<td>The field repeats down the page n times.
<tr><th>n x m<td>The field repeats n times down the page, for m columns, eg
<tr><td align="center">3x2<td>1 4<br>2 5<br>3 6
<tr><th>n y m<td>The field repeats m times across the page, for n lines, eg
<tr><td align="center">3y2<td>1 2<br>3 4<br>5 6
</table>
<p>
After entering a repeating field and pressing OK, select resize from the right click menu
to set the spacing of the repeated items.
<p>
When the same value(s) should be printed in
more than one place on the report, for example a tear-off slip on a remittance
advice, then the field should be defined independently in both positions, In
which case a check is made to ensure they repeat the same number of times.
<p>
<p>
If the repeat field is not blank or 1, the variant group and set are shown.
<p>
<h5>Variant Set and Number</h5>
The variant set indicates which other fields should not be printed because this field has.
For example, when printing<br>
<ol>
<li> order detail lines, eg OIprod, OIdesc, OIqty, and OInet: variant set 1, no 1
<li> serial number, variant set 1, no 2
<li> comment details, variant set 1, no 3
</ol>
all in the same space on the page, these should all be in the same variant set.<p>
When, for example, OIprod is printed, it marks slots for other fields in the same 
variant set but with a different variant number as used, to prevent overprinting by
subsequent serial and comment details. 
If the three lines
above repeat ten times down the page, when the first record (say OI) is detected in the
datastream, it occupies slot 1 and slot 1 for serial and comment details is marked
as used. If the next record is, say, a serial number, it goes in slot 2 and slot 2 is
marked as used on the detail and comment fields.
<p>
When variant numbers are in use, the layout designer displays the field in the corresponding
slot position on the page.
<p>
An example of this is shown on the sample invoice print from pptest.exw.<p>
<p>
The use of variant sets should be independently documented for future reference.
<p>
<!--h5>Group</h5>
<small>[DEV: not implemented in v0.1]</small><br>
The line grouping control is only shown when the variant set and variant number are non-zero.
If set, this should be a dictionary field, so the application can control minor pagination
issues via the datastream.<br>
<p>
                     If the value is a single digit, this indicates the number of lines
                     which must remain free otherwise a page break is forced.
                     A tuple {x,y,z} indicates that a page break should occur if the 
                     next x lines printed would otherwise leave less than y lines on
                     the current page or less than z lines on the following page.<p>
                    For example, {10,3,2} could be used to indicate this is a ten-line
                    paragraph and that if only 3 or fewer lines can fit on the current
                    page then start the paragraph on the next page, or if...
<p>
<b>Note</b>Any use of line grouping formulas should be independently documented for 
future reference, although this may be self evident in the datastream creation program in
some cases.
<p-->
<h5>Colour</h5>
Select one of the standard windows colours from the drop-down, enter an rgb value, or 
press F1 or click on the button to the right of the field to open the standard windows 
colour selection dialog. In edit mode the display is updated as the fields are altered 
(not insert mode).
<p>
<h5>Font and Size</h5>
Select one of the available fonts from the drop-down. The list is restricted to true-type
and/or fixed width fonts by the checkboxes above the font selection. In edit mode the 
display is updated as the fields are altered (not insert mode).
<p>
<h5>Rotation></h5>
Not available on repeat fields. Specify a value between 0 and 3600 to rotate the text.
In edit mode the display is updated as the field is altered (not insert mode).
<p>
<h5>Format and Fields</h5>
The Format and Fields follow the same conventions as printf().<p>
A summary of field formats can be found <a href=ppOver.html#formats>here</a> or
<a href=#formats>here</a>. Note in particular that right justification processing occurs
on single items when the second character of the format string is a non-zero number, and 
it is of type d, f, or s. In some cases it may be necessary to avoid this by coding eg:<br>
<pre>
        %s  %asstring
where
        %asstring is sprintf("%8.2f",&lt;actual field&gt;)
</pre>
The six buttons to the right of the field window correspond to pressing F1 to F6 in the
Format field. The sixth button is always present, but disabled on this window, to be
consistent with the <a href=#Calculated>Calculated Fields Window</a>, on which the fifth
button is disabled (even if it could open a second copy of that window, it would just be
far too confusing!).<p>

<a name=F1F6></a>
When a function key F1..F6, or the corresponding button is pressed, a field lookup window
is displayed:<p>
<p>
<table border align="center" cellpadding=10 cellspacing=0>
<tr><th>F1<td>?<td>Dictionary field, eg OIvat.<td><a href=#jdictLookup>Screenshot</a>
<tr><th>F2<td>$<td>Standard field, eg $Page.<td><a href=#jstdLookup>Screenshot</a>
<tr><th>F3<td>%<td>Previously defined calculated field, eg %due.<td><a href=#jcalcLookup>Screenshot</a>
<tr><th>F4<td>@<td>Summation, eg @cOInetOH.<td><a href=#jsummations>Screenshot</a>
<tr><th>F5<td>=<td>Define new calculated field (not via F5).<td><a href=#jcalcdef>Screenshot</a>
<tr><th>F6<td><i>f</f><td>Functions (only via F5).<td><a href=#jfunctions>Screenshot</a>
</table>
<p>
When fields are selected from the lookup, the name and format are automatically inserted,
with required brackets and commas.<p>
Quick Example: In the Format field, type "Page ", then press F2 and select $Page.<p>
The Format field now shows "Page %d" and the Fields "{$Page}".<p>
Now type " of ", press F2 and select $Page again (make a deliberate mistake).<p>
The Format field now shows "Page %d of %d" and the Fields "{$Page,$Page}", (not quite what we want).<p>
Backspace twice to delete the last %d, and press F2, this time select $Pmax.<p>
The Format field now shows "Page %d of %d" and the Fields "{$Page,$Pmax}".<p>
This is displayed as "Page $Page of $Pmax" on the report layout, and of course as eg "Page 1 
of 43" on the preview and printed page.<p>
<p>
If the appropriate format qualifier (eg "%d") is deleted before pressing a function key 
or pressing one of the six buttons, the corresponding field entry is replaced.
<p>
While it is possible to edit the Fields entires by hand, hopefully in most cases
this will not be necessary.<p>
<p>
Note that it is not possible to specify calculations directly in the field list, for
example "%8.2f" {OHnet+OHvat} is not allowed, instead "%8.2f" {%due}, with %due defined
as OHnet+OHvat, must be used. This is necessary to maintain a clean aspect in the layout
editor, as eg "Vat %vat" keeps the display neat and tidy, but 
"Vat&nbsp;((OIgross=0)*OInet*0.175+(OIgross!=0)*(OIgross-floor(OIgross/1.175)))/100"
certainly does not.
<p>
<a name=Dictionary></a>
<h3>Dictionary Lookup</h3>
<!----------------------->
<a name=jdictLookup></a>
<a href="ppRef2.html#jedittext">Previous ScreenShot</a>
<a href="ppRef2.html#jstdLookup">Next ScreenShot</a><p>
<img src="images/dict.jpg"
     alt="The Dictionary Lookup Window.">
<br>
The Dictionary Lookup Window.
<p>
Cursor to the required line and press Return, or double click on a line to select the field.<p>
A <a href=ppOver.html#jrecords>record lookup</a> is available by pressing F1 or Ctrl Q.<p>
Text from this window may also be selected and copied to the Windows clipboard using the mouse.<p>
<p>
<a name=Standard></a>
<h3>Standard Fields Lookup</h3>
<!---------------------------->
<a name=jstdLookup></a>
<a href="ppRef2.html#jdictLookup">Previous ScreenShot</a>
<a href="ppRef2.html#jcalcLookup">Next ScreenShot</a><p>
<img src="images/standard.jpg"
     alt="The Standard Fields Lookup Window.">
<br>
The Standard Fields Lookup Window.
<p>
Cursor to the required line and press Return, or double click on a line to select the field.<p>
Suggestions for additional standard fields are welcome.
<!--p>
    Standard built-in fields can be used for page numbering, date, time, and constants:
<pre>
        $Page   %d      the current page number.                (See also @p summations)
        $Pmax   %d      total number of pages in the report.      ""
        $AmPm   %2s     "am" or "pm". 12am=midnight, 12pm=noon.
        $D      %02d    day of month
        $Dth    %4s     ordinal day of month, eg "2nd"
        $M      %02d    month (1=January)
        $Mmm    %3s     month 3 characters, eg "Jan"
        $Mmmm   %9s     month eg "January"
        $Yy     %02d    short year, eg 3 for 2003
        $Yyyy   %4d     long year, eg 2003
        $Hour   %02d    hour of day 0..23
        $H12    %02d    12-hour of day, 1..12
        $Min    %02d    minute 0..59
        $Sec    %02d    second 0..59 (at report start)
        $Doy    %d      day of year
        $W      %1d     day of week (1=Sunday)
        $Www    %3s     day of week 3 characters, eg "Thu"
        $Wwww   %9s     day of week eg "Thursday"
        $E      %f      e, 2.718281828
        $PI     %f      pi, 3.141592654
</pre-->
<p>
Examples of use (see <a href="ppRef2.html#jedittext">The Field Details (Text) Window</a>):
<p>
<table border cellpadding=30 cellspacing=0>
<tr><th>Format<td>Page %d of %d<td>%s, %s %s %d %02d:%02d%s
<tr><th>Fields<td>{$Page,$Pmax}<td>{$Wwww,$Dth,$Mmmm,$Yyyy,$H12,$Min,$AmPm}
<tr><td>Example output<td>Page 1 of 37<td>Thursday, 2nd January 2003 02:37pm
</table>
<p>
Note that by pressing F2 and selecting from the popup, the only text which must be manually
entered is "Page " and " of " for the first example(middle column), and a comma, four spaces
and a colon(":") in the second example. 
The Fields list is built automatically (but can be edited when necessary).
<p>
Standard fields may also be used on calculated fields. The following standard calculated
fields are distributed:
<table border cellpadding=10 cellspacing=0>
<tr><td>%time<td>sprintf("%02d:%02d%s",{$H12,$Min,$AmPm})<td>eg 02:37pm
<tr><td>%sdate<td>sprintf("%02d/%02d/%02d",{$D,$M,$Yy})<td>eg 25/12/03
<tr><td>%ldate<td>sprintf("%s, %s %s %d %02d:%02d%s",<br>{$Wwww,$Dth,$Mmmm,$Yyyy,$H12,$Min,$AmPm})
    <td>eg Thursday, 2nd January 2003 02:37pm
</table>
<p>
<p>
<a name=Calculated></a>
<h3>Calculated Fields Lookup</h3>
<!------------------------------>
<a name=jcalcLookup></a>
<a href="ppRef2.html#jstdLookup">Previous ScreenShot</a>
<a href="ppRef2.html#jsummations">Next ScreenShot</a><p>
<img src="images/calclist.jpg"
     alt="The Calculated Fields Lookup Window.">
<br>
The Calculated Fields Lookup Window.
<p>
Cursor to the required line and press Return, or double click on a line to select the field.<p>
<p>
The contents of the calculated fields window can be selected and copied (via the right 
click menu or Ctrl A, Ctrl C) for documentation purposes.<p>
<p>
<a name=Summations></a>
<h3>Summations</h3>
<!---------------->
<a name=jsummations></a>
<a href="ppRef2.html#jcalcLookup">Previous ScreenShot</a>
<a href="ppRef3.html#jcalcdef">Next ScreenShot</a><p>
<img src="images/summation.jpg"
     alt="The Summation Definition Window.">
<br>
The Summation Definition Window.
<p>
Summation fields are shown as eg @sOIvatOH. The field name consists of four parts.<p>
The first character @ indicates it is a summation field.<p>
The second character determines which of the seven types it is:
<p>
<table border align="center" cellpadding=10 cellspacing=0>
<tr><th>Type<td>Field<td>Record<td>Meaning
<tr><th>s<td>Yes<td>Yes<td>Sum the specified field; print and clear when the specified record is
                            encountered, and at end of datastream.
<tr><th>b<td>Yes<td>Yes<td>A brought forward amount, cleared (and not printed) when the
                            specified record is encountered, printed at start of page.
<tr><th>c<td>Yes<td>Yes<td>A carried forward amount, cleared (and not printed) when the 
                            specified record is encountered, printed at end of page.
<tr><th>f<td>Yes<td>No<td>A final summation, printed at the end of the report.
<tr><th>p<td>Yes<td>No<td>A page summation, printed and cleared at the end of each page.
<tr><th>n<td>No<td>Yes<td>Page number within section (Page n of m).
    <small>[Use $Page for whole report.]</small>
<tr><th>m<td>No<td>Yes<td>Number of pages in section (Page n of m).
    <small>[Use $Pmax for whole report.]</small>
</table>
<p>
The field to be summed is the third part of the name (not present on section numbers).<br>
This should be a numeric field from the datastream.
<p>
The last two characters of the name (not present on final and page summations) is the
controlling record which determines when the accumulator should be reset.
<p>
The example invoice print has examples of all these types.
<p>
<h4>A small warning</h4>
Carried forward amounts (and brought forward amounts) are triggered when a page break
is forced by a <i>Different</i> record to the one specified on the summation field.
<p>
Remember I said the datastream carries a simple, common sense semantic statement of intent?
In some ways the records trigger events on the report, such as start a new page, or print
a subtotal (if it helps to think of it that way).
<p>
Suppose, as in the example dictionary, sales orders are passed in OH records. Further
imagine there are some additional records related to the order header, such as a delivery
address record (DA) or the customer details perhaps, and the the order item (OI) records 
might also have batch, serial, comment, delivery, or other information associated with them
also passed as different records (say OB,OS,OC,OD).
<a>
Also let's specifically concentrate on the carried forward summation @cOIqtyOH.
<p>
The report generator obviously knows if you specified, say print 10 order items per page,
then obviously it knows not to throw a page unnecessarily when any OI..OD are found.
It also knows that if it must start a new page, then the carried forward amount should be
printed.
<p>
However, if another DA record is encountered, before the OH, it will trigger a page break,
and will also cause the carried forward amount to be printed. If you know for certain that
the DA record always occurrs before every OH record, then the summation can just be
changed to @cOIqtyDA, otherwise the datastream will need modifying.
<p>
If you are going to use a record to control subtotalling, then it should logically 
correspond to the reporting event, and <i>must</i> be physically placed in the datastream
before all other related records.
<p>
In some cases it may be necessary to invent new records for the datastream for the explicit
purpose of controlling this.
<p>
For more advanced report subtotalling, consider directly manipulating the pagetable
via the <a href="#PSHook">pageSequenceHook</a> routine.
<p>
Avoid the use of s and f style summations (sum over section and final sum) when these
can more efficiently be coded in the datastream creation program.
<p>
Note that only type s summations may be used on repeating fields (and any calculation
used by a repeating field) since, by definition, the remainder are page-oriented.
<p>
<p>
</body>
<p><p><hr></p>
<p align=center>
<a href="pprg.html">Table of Contents</a>
<a href="ppRef.html">Previous Page - Reference Section Part 1</a>
<a href="ppRef3.html">Next Page - Reference Section Part 3</a>
</p>
<p><hr><p><p>
</html>