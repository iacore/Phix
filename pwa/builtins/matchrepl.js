"use strict";
// auto-generated by pwa/p2js - part of Phix, see http://phix.x10.mx
//
// matchrepl.e
//
// Phix implementation of match_replace (auto-include)
//

/*global*/ function match_replace(/*object*/ needle, /*sequence*/ haystack, /*object*/ replacement, /*integer*/ maxr=0) {
    let /*integer*/ posn, needle_len, replacement_len;
    if (atom(needle)) {
        needle = ["sequence",needle];
    }
    if (atom(replacement)) {
        replacement = ["sequence",replacement];
    }
    needle_len = length(needle);
    replacement_len = length(replacement);
    posn = match(needle,haystack);
    while (posn) {
        haystack = $repss(haystack,posn,(posn+needle_len)-1,replacement);
        posn = match(needle,haystack,posn+replacement_len);
        maxr -= 1;
        if (maxr===0) { break; }
    }
    return haystack;
}
